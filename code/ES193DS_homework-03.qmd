---
title: "ES 193DS homework 3"
date: 2024-06-02
author: "Katelyn Vidal"
format: html
---

### Problem 1. Multiple linear regression: model selection and construction (52 points)

Use the information from the `homework-starter-doc.qmd` to do this problem.

# Set up:

## reading in packages

```{r}
#| message: false

# general use
library(tidyverse)
library(readxl)
library(here)
library(janitor)

# visualizing pairs
library(GGally)

# model selection
library(MuMIn)

# model predictions
library(ggeffects)

# model tables
library(gtsummary)
library(flextable)
library(modelsummary)
library(ModelMetrics)

drought_exp <- read_xlsx(path = here("data", 
                                     "Valliere_etal_EcoApps_Data.xlsx"),
                         sheet = "First Harvest")

# quick look at data 
str(drought_exp)
class(drought_exp)
```

## cleaning

```{r}
# cleaning
drought_exp_clean <- drought_exp %>% 
  clean_names() %>% # nicer column names
  mutate(species_name = case_when( # adding column with species scientific names
    species == "ENCCAL" ~ "Encelia californica", # bush sunflower
    species == "ESCCAL" ~ "Eschscholzia californica", # California poppy
    species == "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    species == "GRICAM" ~ "Grindelia camporum", # great valley gumweed
    species == "SALLEU" ~ "Salvia leucophylla", # Purple sage
    species == "STIPUL" ~ "Nasella pulchra", # Purple needlegrass
    species == "LOTSCO" ~ "Acmispon glaber" # deerweed
  )) %>% 
  relocate(species_name, .after = species) %>% # moving species_name column after species
  mutate(water_treatment = case_when( # adding column with full treatment names
    water == "WW" ~ "Well watered",
    water == "DS" ~ "Drought stressed"
  )) %>% 
  relocate(water_treatment, .after = water) # moving water_treatment column after water
```

# Visualizing:

## correlations

```{r}
ggpairs(drought_exp_clean, # data frame
        columns = c("leaf_dry_weight_g", # columns to visualize
                    "sla", 
                    "shoot_g", 
                    "root_g", 
                    "total_g"), 
        upper = list(method = "pearson")) + # calculating Pearson correlation coefficient
  theme_bw() + # cleaner theme
  theme(panel.grid = element_blank()) # getting rid of gridlines
```

## 0. Null model

```{r}
model0 <- lm(total_g ~ 1, # formula
             data = drought_exp_clean) # data frame
```

## 1. total biomass as a function of SLA, water treatment, and species

```{r}
# saturated model
model1 <- lm(total_g ~ sla + water_treatment + species_name,
             data = drought_exp_clean)

par(mfrow = c(2, 2))
plot(model1)
```

## 2. total biomass as a function of SLA and water treatment

```{r}
model2 <- lm(total_g ~ sla + water_treatment,
             data = drought_exp_clean)

plot(model2)
```

## 3. total biomass as a function of SLA and species

```{r}
model3 <- lm(total_g ~ sla + species_name,
             data = drought_exp_clean)

plot(model3)
```

## 4. total biomass as a function of water treatment and species

```{r}
model4 <- lm(total_g ~ water_treatment + species_name,
             data = drought_exp_clean)

plot(model4)
```

#### a. Make a table *or* list of all the models from class and the last one you constructed on your own. Write a caption for your table. (8 points)

**Caption:** table captions typically go above the table. Number the table and provide a title. Describe what is in the table (columns and rows).

**Table:** In your table, each row should be a model with the model number (1, 2, 3, etc.) and the predictors for each model.

```{r}
# comparing models
modelsummary::modelsummary( # this function takes a list of models
  list( 
    "null" = model0, # "model name" = model object
    "model 1" = model1,
    "model 2" = model2,
    "model 3" = model3,
    "model 4" = model4))

```

::: callout-note
#### Double check your work!

There should be 5 models total (null model + 4 models with predictors).
:::

#### b. Write a 5-6 sentence "statistical methods" section. (8 points)

Your answer should be in paragraph form and include:

-   how you addressed the central question(s) (i.e. to examine the influence of \_\_\_\_, \_\_\_\_, and \_\_\_\_ on \_\_\_\_\_, I...)\
-   how you chose the final model (i.e. to determine the model that best described \_\_\_\_, I...)\
-   how you visually determined that your final model conformed to the assumptions of a linear model (i.e. to evaluate linear model assumptions, I...)

**To examine the influence of specific leaf area, water treatment, and species on total biomass, I looked at the structure of the data and I visualized the correlations of a selected group of variables to each other. I also looked at how each variable influenced total biomass through a combination of scatter and jitter plots. To determine the model that best described total biomass, I. To evaluate linear model assumption, I looked at the diagnostics for each scenario.**

#### c. Make a visualization of the model predictions with underlying data for your "best" model. (20 points)

Show and annotate all your code. For full credit:

-   make the underlying data more transparent than the model predictions\
-   display species names in full (not as species codes like ENCCAL or ESCCAL)\
-   display water treatment types in full (not as WW or DS)\
-   represent well-watered and drought stressed treatments with different colors\
-   use colors that are *not* the default `ggplot()` colors\
-   facet your plot by species\
-   remove the legend\
-   finalize the plot

::: callout-note
Make sure that the only output is the visualization!
:::

```{r}
# model predictions for model 1
model_preds <- ggpredict(model1, 
                         terms = c("sla",
                                   "water_treatment", 
                                   "species_name"))
```

```{r}
# creating new data frame of model predictions for plotting
model_preds_for_plotting <- model_preds %>% 
  # renaming columns to make this easier to use
  rename(sla = x, 
         water_treatment = group,
         species_name = facet)

# visualization of the model predictions with underlying data for model 1
ggplot() +
  # underlying data
  geom_point(data = drought_exp_clean,
             aes(x = sla,
                 y = total_g,
                 color = water_treatment),
             alpha = 0.2) +
  # model prediction 95% CI ribbon
  geom_ribbon(data = model_preds_for_plotting,
              aes(x = sla, 
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high,
                  fill = water_treatment),
              alpha = 0.2) +
  # model prediction lines
  geom_line(data = model_preds_for_plotting,
            aes(x = sla, 
                y = predicted,
                color = water_treatment)) +
  # change color of prediction lines and underlying data
  scale_color_manual(values = c("mediumorchid4", "darkseagreen4")) +
  # change color of model prediction 95% CI ribbon
  scale_fill_manual(values = c("mediumorchid4", "darkseagreen4")) +
  # cleaner theme
  theme_classic() +
  # creating different panels for species
  facet_wrap(~species_name) +
  # rename x and y axes
  labs(x = "Specific leaf area (mm^2/g)",
       y = "Total biomass (g)") +
  # remove legend
  theme(legend.position = "none")
  
```

#### d. Write a caption for your visualization. (6 points)

**Figure 1. Predicted values of total biomass**\
**Data from 'Dryad' package (Valliere J, Zhang J, Sharifi M., Rundel P, 2019). Points represent observations of the specific leaf area (mm\^2/g) and total biomass (g) of species in well watered and drought stressed water treatments, (total n = 70). The lines represents the model prediction of total biomass of species for each water treatment. The ribbon represents the 95% CI around the model predictions. Colors represent water treatment type (purple = well watered, green = drought stressed).**

#### e. Write a 3-4 sentence results section. (10 points)

Your answer should be in paragraph form and address the following points:

-   what predictors "best" described total mass (include model statistics here)?\
-   on average, what differences did you find between water treatments?\
-   on average, what differences did you find between species?

**Results:**\
**On average, in well watered water treatments**

### Problem 2. Affective visualization (24 points)

In this problem, you will create an **affective visualization** using your personal data in preparation for workshop during week 10.

In lecture, we talked about the three vertices of data visualization: 1) exploratory, 2) affective, and 3) communicative. We've done a lot of exploratory and communicative visualization, but have yet to think about affective visualization.

When thinking of affective visualization, you can expand your ideas of what data visualization *could* be. Some examples of affective visualizations include:

-   [Jill Pelto's paintings](https://www.jillpelto.com/gallery-1)\
-   [Lorraine Woodruff-Long's warming strips quilt](https://www.instagram.com/p/C689Kybxget/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA==)\
-   [Stefanie Posavec and Giorgia Lupi's Dear Data project](https://www.dear-data.com/all)

**Before starting, update your spreadsheet of observations.**

#### a. Describe in words what an affective visualization could look like for your personal data (3-5 sentences). (2 points)

**For my personal data, I could crochet a square, with each stitch representing how much I spend for each meal, and use different colors to represent the meal type. I could also have each row represent each week, and use white yarn to fill in the remaining stitches (each row will have about 40 stitches). This will allow me to see which meals I tend to spend the most money on and see which weeks I spent the most and least amount of money. I could also separate each month by using a contrasting yarn color.**

#### b. Create a sketch (on paper) of your idea. (2 points)

![](images/IMG_1970.jpeg)

#### c. Make a draft of your visualization. (12 points)

Feel free to be creative with this! *You do not have to do this in R.* You could create a sculpture, painting, textile object, etc.

If you are making your visualization in R, show the annotated code and the output.

If you are making your visualization outside of R, include a photo of your visualization in your submission.

#### d. Write an artist statement. (8 points)

An artist statement gives the audience context to understand your work. Write 4-5 sentences to address:

-   the content of your piece (what are you showing?)\
-   the influences (what did techniques/artists/etc. did you find influential in creating your work?)\
-   the form of your work (written code, watercolor, oil painting, etc.)\
-   your process (how did you create your work?)

**This crochet piece represents my weekly and monthly spending habits on food with each stitch representing the cost of a meal (USD, rounded up) and each row representing each week, separated by a row of black stitches to represent different months. The colors represent the type of meal (blue = lunch, light brown = snack, dark brown = dinner) and the white yarn is used to fill up the remaining space in the row (rows contain 40 stitches each). This piece is influenced by Lorraine Woodruff-Long's warming strips quilt representing global temperature change, which inspired me to show how my spending habits on food changed over time. I created this piece by first calculating what my max cost of food was in each week to determine how many stitches to include in each row. I then I started crocheting, adding in each color, filler, and divider until I reached the end of my observations.**

### Problem 3. Statistical critique (36 points)

At this point, you have seen and created a lot of figures for this class. Revisit the paper you chose for your critique and your homework 2, where you described figures or tables in the text. Address the following in full sentences (3-4 sentences each).

**For this section of your homework, you will be evaluated on the logic, conciseness, and nuance of your critique.**

#### a. Revisit and summarize (6 points)

What are the statistical tests the authors are using to address their main research question?

**The statistical tests the authors used to address their main reseach question are t-tests, ANOVA, Mann-Whitney, Kruskal-Wallis, Wilcoxon rank sum, linear model, and Pearson correlation**

Insert the figure or table you described in Homework 2 here.

#### b. Visual clarity (10 points)

How clearly did the authors *visually* represent their statistics in figures? For example, are the x- and y-axes in a logical position? Do they show summary statistics (means and SE, for example) and/or model predictions, and if so, do they show the underlying data?

**Answer**

#### c. Aesthetic clarity (10 points)

How well did the authors handle "visual clutter"? How would you describe the the data:ink ratio?

**Answer**

#### d. Recommendations (can be longer than 4 sentences, 10 points)

What recommendations would you make to make the figure better? What would you take out, add, or change? Provide explanations/justifications for each of your recommendations.

**Alternatively**, if they did not represent their statistics in a figure, what kind of figure would you recommend to them? Describe the x- and y-axes, with any geometries and aesthetics (colors, etc.). Provide enough explanation such that someone would be able to create the figure you describe in code. Provide explanations/justifications for the figure you would recommend.

**Answer**
